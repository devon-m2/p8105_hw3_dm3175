---
title: "p8105_hw3_dm3175"
author: "Devon Morgan"
date: "10/9/2018"
output: github_document
---

```{r setup, include=FALSE}
library(tidyverse)
library(ggridges)
library(patchwork)
library(p8105.datasets)
library("dplyr")
library(viridis)
knitr::opts_chunk$set(
  fig.width = 10,
  fig.asp = .6,
  out.width = "90%"
)

```

# Problem 1

The BRFSS dataset includes data from the Behavioral Risk Factors Surveillance System from 2002-2010. This dataset is located in the `p8105.datasets` package. The same dataset was used in homework 2.  

## Import and Clean Dataset
Loaded and cleaned BRFSS data from `p9105.datasets` package: 

```{r load BRFSS Data}
brfss_data = p8105.datasets::brfss_smart2010 %>% 
    janitor::clean_names() %>%
    filter(topic == "Overall Health") %>% 
    mutate(response = factor(response, levels = c("Excellent", "Very good", "Good", "Fair", "Poor")))
  
```

The following steps were taken to clean the dataset: 

*  Cleaned variable names using `janitor::clean_names`.

*  Verified variable types imported correctly.

*  Filtered data to only consider "Overall Health" topic.

*  Using the `factor` function, organized the responses as a factor ordered with 5 levels: `Excellent`, `Very good`, `Good`, `Fair`, and `Poor`. 

## Questions

*  **In 2002, which states were observed at 7 locations?**

Using a combination of `group_by` and `summarize` functions, it can be found that in 2002, the following states were observed at 7 locations. Note that other states were observed at less than or greater than 7 locations. 

```{r}
brfss_data %>% 
  filter(year == 2002) %>% 
  group_by(locationabbr) %>% 
  summarize(count_locations = n_distinct(locationdesc)) %>% 
  filter(count_locations == 7) %>% 
  knitr::kable(digits = 1)
```


*  **Make a “spaghetti plot” that shows the number of locations in each state from 2002 to 2010.**

The following spaghetti plot displays the number of locations in each state from 2002 to 2010. The states are differentiated by colors as presented in the legend. 

```{r number of locations in each state}
brfss_data %>%
  group_by(year, locationabbr) %>% 
  summarize(count_locations = n_distinct(locationdesc)) %>%
  ggplot(aes(x = year, y = count_locations, color = locationabbr)) + 
  geom_line(se = FALSE) +
  labs(
    title = "Number of Sampling Locations in Each State, 2002 to 2010",
    x = "Year",
    y = "Number of Distinct Sampling Locations",
    caption = "Data from the BRFSS 2010 Dataset"
  ) + 
  theme_bw()

```


*  **Make a table showing, for the years 2002, 2006, and 2010, the mean and standard deviation of the proportion of “Excellent” responses across locations in NY State.**

The following table displays the mean and standard deviation of the proportion of "Excellent" responses across locations in NY State. 

```{r}
brfss_data %>% 
  filter(locationabbr == "NY" & 
           (year == 2002 | year == 2006 | year == 2010) &
           response == "Excellent") %>% 
  group_by(year) %>% 
  summarize(mean_excellent_response = mean(data_value),
            sd_excellent_response = sd(data_value)) %>%
  knitr::kable(digits = 1)
```

*  **For each year and state, compute the average proportion in each response category (taking the average across locations in a state). Make a five-panel plot that shows, for each response category separately, the distribution of these state-level averages over time.**
*****FINISH*****

```{r}
brfss_data %>%
  group_by(year, locationabbr, response) %>% 
  summarize(mean_response = mean(data_value))

    
```


# Problem 2

The Instacart Online Grocery Shopping Dataset (Instacart) from 2017 contains data from an online grocery service that permits shopping from local stores online, delivering groceries quickly. The dataset includes online order data from more than 200,000 users.   

```{r load instacart data}
instacart_data = p8105.datasets::instacart %>% 
    janitor::clean_names()
    
```

## Description of dataset

The instacart dataset 


### Variable Descriptions
The following is a list of all the variables within the dataset and corresponding descriptions for reference taken from the dataset description on http://p8105.com/dataset_instacart.html. 

*  `order_id`: order identifier
*  `product_id`: product identifier
*  `add_to_cart_order`: order in which each product was added to cart
*  `reordered`: 1 if this prodcut has been ordered by this user in the past, 0 otherwise
*  `user_id`: customer identifier
*  `eval_set`: which evaluation set this order belongs in (Note that the data for use in this class is exclusively from the “train” eval_set)
*  `order_number`: the order sequence number for this user (1=first, n=nth)
*  `order_dow`: the day of the week on which the order was placed
*  `order_hour_of_day`: the hour of the day on which the order was placed
*  `days_since_prior_order`: days since the last order, capped at 30, NA if order_number=1
*  `product_name`: name of the product
*  `aisle_id`: aisle identifier
*  `department_id`: department identifier
*  `aisle`: the name of the aisle
*  `department`: the name of the department


## Questions

*  **How many aisles are there, and which aisles are the most items ordered from?**

There are `r distinct(instacart_data, aisle, .keep_all = TRUE) %>% nrow()` aisles noted in the dataset. The top 10 most frequently used aisles are displayed in the table below. These represent the aisles where the most ordered items originate from. The top three aisles are **fresh vegetables, fresh fruits, and packaged vegetable fruits**. 

```{r}
instacart_data %>% 
  group_by(aisle) %>% 
  summarize(distinct_aisle = n()) %>%
  filter(min_rank(desc(distinct_aisle)) < 11) %>% 
  knitr::kable(digits = 1)
```


* **Make a plot that shows the number of items ordered in each aisle. Order aisles sensibly, and organize your plot so others can read it**
The following plot displays the number of items ordered in each aisle. 

```{r}

```


* **Make a table showing the most popular item aisles "baking ingredients", "dog food care", and "packages vegetables fruits"**


* **Make a table showing the mean hour of the day at which Pink Lady Apples and Coffee Ice Cream are ordered on each day of the week; format this table for human readers (i.e., produce a 2 x 7 table)**

```{r}

```


